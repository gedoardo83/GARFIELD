# GARFIELD-NGS
GARFIELD-NGS: Genomic vARiants FIltering by dEep Learning moDels in NGS
<br> By Viola Ravasio and Edoardo Giacopuzzi (edoardo.giacopuzzi@unibs.it)
Version 1.1

USAGE: `perl Predict.pl --input input.vcf[.gz] --output output.vcf --platform [illumina/ion]`

GARFIELD-NGS is implemented as Perl script and requires java to perform predictions. Tool was tested on RHEL operating system v.7.2, with Perl v.5.16 and Java JDK 1.8.0_65. Bgzip is also needed and must be available from your path to handle compressed VCF files.

### General information

Clone the current repository to any folder and then run the Predict.pl script from any location. All included files must be placed in the same folder as Predict.pl file. Temporary files are created during prediction process in the same folder of input.vcf file and automatically removed.

GARFIELD-NGS takes an input vcf (or vcf.gz) file generated by GATK for Illumina platform or TVC (Torrent Variant Caller) for ION. Prediction scores are added as `SampleName_true=value` in the INFO column in the output VCF. Platform for prediction (ion/illumina) must be specified by `--platform` option
<br>Please note that GARFIELD-NGS is optimized to work on single sample VCF. Multisample VCF can be processed (see below) and in this case, an independent CP value is added in output file for each sample in the format `SampleName_true=value`.
<br>The tool returns a standard VCF output and can thus be easily integrated in already established analysis pipelines.

Predictions are made based on four deep learning models specifically trained on INDELs and SNPs from Illumina and ION platforms. Calculated CP value ranges from 0 to 1, with higher values associated to true variants.
Variants with score below filtering threshold should be considered as false positive. 

### Suggested CP thresholds for filtering:
<br>**ION**       SNPs 0.139  INDELs 0.320
<br>**Illumina**  SNPs 0.025  INDELs 0.630

### Suggestions for analysis of multi-sample files</bold>
<br>GARFIELD-NGS is designed to score variants in VCF files generated from single sample data. We have tested the tool also on small multi-sample VCF up to three subjects (trio analysis). 
<br>The best solution in this case is to use GARFIELD-NGS on the single-sample VCFs, merge the original files using vcftools, and then use the provided AddScoreToMultisample.pl script to annotate the merged VCF. The script takes single sample VCFs and the merged VCF as input and annotate the latter with GARFIELD-NGS scores from each sample.

**Example:**
<br>Given 3 single-sample VCF: input1.vcf.gz, input2.vcf.gz, input3.vcf.gz
<br>1. Annotate each file using GARFIELD-NGS:
<br>  `Predict.pl --input input1.vcf.gz --platform illumina --output input1.GAR.vcf`
<br>2. Merge VCF files using vcf-merge
<br>  `vcf-merge input1.vcf.gz input2.vcf.gz input3.vcf.gz > input.merged.vcf`
<br>3. Add GARFIELD score for each sample to the merged VCF file using AddScoreToMultisample.pl
<br>  `AddScoreToMulticample.pl --singleVCF input1.vcf.gz,input2.vcf.gz,input3.vcf.gz --multiVCF input.merged.vcf --output input.merged.GAR.vcf`

<br>Alternatvely, you can use a multi-sample file generated by join call of all the three samples using GATK, but prediction value may be less reliable. Our prediction models are based on INFO column values that are computed per variant by variant callers, so in multi-sample files these values will be based on the cumulative data across all samples and this could alter prediction reliability on single samples. 
<br>Avoid to run GARFIELD-NGS on a multi-sample file generated by merging single-sample VCF with vcftools (vcf-merge). The variant annotations in the resulting files will correspond to only one of the merged VCFs and this will result in altered predictions.

For additional information on GARFIELD-NGS see our paper on Bioinformatics:
https://academic.oup.com/bioinformatics/article-abstract/34/17/3038/4970515
